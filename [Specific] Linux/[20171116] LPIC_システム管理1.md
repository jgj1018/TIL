# 9.1ユーザーとグループの管理

# 9.1.1　ユーザーアカウントと/etc/passwd
ユーザーアカウント情報は/etc/passwdファイルに保存。

例)

```
lpic:x:1000:1000:LPI Linux :/home/lpic:/bin/bash
```

- パスワード：暗号化されたパスワード
- UID:ユーザーを識別するための一意なID
- GID:グループを識別するための一意なID
- ホームディレクトリ：ユーザーのホームディレクトリの絶対パスを格納
- デフォルトシェル：ユーザーがログインしたり新たにシェルを聞いた際に起動されるシェルの絶対パスを格納

：現在では車道パスワードを使い、パスワード情報は/etc/shadowに格納するようになっている。/etc/shadowはスーパーユーザーしか読み出しができない。

# 9.1.2 グループアカウントと/etc/group

例）

```
staff:x:1002:linux,lpic
```
- グル0プメンバー：このグループをサブグループとして所属するユーザーのユーザー名が入る。複数のユーザーが属している場合は,で区切って並ぶ。

ユーザーは複数のグループに属することができる。ユーザーにとって基本となるグループをプライパリグループ（基本グループ）、それ以外に参加しているグループをサブグループという。

# 9.1.3 コマンドを用いたユーザーとグループの管理

`useradd`

- -c 「コメント」：コメントフィールドを指定する
- -d 「パス」：フームディレクトリを指定する
- -s 「パス」：デフォルトシェルを指定する
- -m ：ホームディレクトリを自動的に作成する

ホームディレクトリのデフォルトファイル

：ホームディレクトリ作成時に配布したいファイルは、ひな形として/etc/skelディレクトリに置いておく。

`usermod`

既存のユーザーアカウントを変更する。/etc/passwdファイルの該当のフィールドを書き換えた場合と同じになる。
以下ではユーザーlpicがプライマリーグループ以外に所属するグループをbprojectに変更する。

```
usermod -G bproject lpic
```

長期間使用しなくなる場合、セキュリティ上の観点から、アカウントを利用不可にしておく場合、アカウントを削除するのではなく、-L をオプションを使ってロックをかけると、アカウントを一時的に無効化できる。

`userdel`

ユーザーアカウントを削除する。
- -r ホームディレクトリも同時に削除する。

`passwd`

パスワードを変更する。スーパーユーザー以外は、自分のパスワードだけを変更できる。

- -l パスワードをロックし、一時的に無効化する。
- -u パスワードのロックを解除する。

`groupadd`

グループを作成する

`groupmod`

既存のグループ情報を変更する

- -g GID　GIDを変更する
- -n グループ名　グループ名を変更する

次の例では、develグル0プの名称をdevelopに変更している

```
#groupmod -n develop devel
``` 

`groupdel`

グループを削除する

削除対象のグループをプライマリグループとしているユーザーが一人でもいると、グループは削除できない。

`id`

ユーザーが所属しているグループを確認
LDAPなどをつかってユーザー情報やグループ情報を統合管理している場合、getentコマンドを使うと、ローカルホストやLDAPサーバなどにあるユーザー情報、グループ情報などを一括して出力することができる

# 9.1.4 シャドウパスワード

/etc/shadowファイルはrootユーザーしか読み取りできないため、/etc/passwdファイルにパスワードを保存していた頃と比較してセキュリティが向上する。


# 9.2 ジョブスケジューリング

定期的に実行するジョブについてはcronを、1っ回限りのジョブの予約についてはatコマンドを使う。

# 9.2.1 cron

スケジュールを管理するデーモンであるcrondと、スケジューリングを編集するcrontabから構成される。crondデーモンは一分ごとに起動され、crontabファイルをしらべて、実行すべきスケジュールが存在すればそのジョブを実行する。

ユーザのcrontabファイルは/var/spool/cronにある。

書式

```
分　時　日　月　曜日　コマンド
```

- 曜日　0~7まで整数（0, 7:日曜～６：土曜）、もしくはSun,Monなどの文字列
- 「＊」は全ての値にマッチする。
- 数字の値をしてする場合は「、」で区切る。

```
0 9,12 * * 1 /usr/local/bin/syscheck
```

間隔を指定して、2分毎（あるいは2時間ごと）指定したければ「＊/2」のようにする。
システム用のcrontabは/etc/crontabにある。

- /etc/cron.hourly/ 1時間に一度実行されるcronジョブを記述したファイルを収めたディレクトリ

# 9.2.2 anacron

指定された時刻にシステムが起動していなかった場合、そのジョブは実行されずじまいになってしまう。これを防ぐのはanacron.
システム停止中に経過してしまったスケジュールを実行することができる。 /etc/anacrontab


# 9.2.3 atコマンド
atによるスケジューリングを実施するには、atデーモン（atd）が動作している必要がある。

- -d　ジョブ　予約中のジョブをジョブ番号で指定して削除する(=atrm)
- -l 予約中のジョブを表示する(=atq)
- -f コマンドを記述したファイルを指定する

- Ctrl + Dキーでコマンドの入力を終了する
次の例は、my_jobsファイルにコマンドを記述している

```
$at -f my_jobs 23:30
```

# 9.2.4 cronとatのアクセス制御

/etc/cron.allowにはcronの利用を許可するユーザーを、/etc/cron.denyにはcronの利用を拒否するユーザーを記述する。

-　/etc/cron.allowファイルがなければ、/etc/cron.denyを参照し、/etc/cron.denyに記述されていないすべてのユーザーがcronを利用できる
-　どちらのファイルもなければ、すべてのユーザーがcronを利用できる

atのアクセス制御にはちょっと違うところがある。

- どちらのファイルもなければ、rootユーザーだけがatを利用できる
