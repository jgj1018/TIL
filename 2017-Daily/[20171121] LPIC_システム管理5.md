# 10.3 メール管理

# 10.3.1　メール配送の仕組み
電子メールを取り扱うソフトウェアには、MTA(Message Transfer Agent)やMDA(Mail Delivery Agent), MUA(Mail User Agent)がある。

- 1、メールクライアントソフトウェアで作成されたメールは、送信用MTA1へ送られる。
- 2、MTA1は、メールアドレスから配送先メールサーバを調べ、メールをMTA2に配送する。
- 3、MTA2がメールを受け取ると、ローカル配送プログラムであるMDAが、メールの宛先となっているユーザーのメールボックスにメールを格納する。
- 受取人側は、POPサーバやIMAPサーバを経由して、自分のメールボックスからメールを取り出す。

メールの配送に使われるMTAは、SMTPプロトコルでメッセージをやり取りするため、SMTPサーバとも呼ばれる。

# 10.3.2MTAの起動

システムによって、どのMTAプログラムがインストールされているかは異なる。

```
# netstat -atnp | grep 25
```

red hat enterprise Linuxやcentosではpostfixが、debian gnu/linuxやubuntuではexim4が使われていることが多い。

# 10.3.3　メールの送信と確認

コマンドラインでメールを送信したり、受信メールを確認するには、mailコマンドを使う。

```
$mail [-s 題名][宛先メールアドレスもしくはユーザー名]
```

メールを受信するには、宛先を指定してmailコマンドを実行する。ユーザー名のみ指定すると、ローカルシステムのユーザー宛にメールが送られる。


```
$ mail -s samplemail student

(本文)

.（入力終了は「.」）
```

# 10.3.4 メールの転送とエイリアス

`/etc/aliases　ファイル`

/etc/aliasesファイルを利用すると、メールアドレスの別名（エイリアス）を設定できる。たとえば、root宛に届いたメールを、ユーザーadminとlpicでも受け取るようにすることができる。

```
root: admin, lpic
```

この設定を有効にするには、newaliasesコマンドを使う。

`.forwardファイル`

メールを転送するもう一つの方法は .forwardファイルを使う方法。この場合は、各ユーザーのホームディレクトリに.forwardファイルを用意し、その中に転送先のメールアドレスを記述する。一時的にメールを転送したい場合などに便利。また、ユーザーが各自で設定できるため、管理者が設定する必要はない。

`メールキューの操作`

送信待ちのメールは、メールキューにはいる。メールの送信ができない場合、メールキューに入って、mailqコマンドで確認できる。

# 10.4　プリンタ管理

# 10.4.1　印刷の仕組み

多くのlinuxディストリビューションでは、印刷サブシステムとして、CUPS(Common unix printing system)を採用している。
CUPSの主な特徴は次の通り。

- IPP(Internet Printer Protocol)
：ネットワーク上のプリンタをサポートするプログラムとして、IPPを採用している。インターネットを経由した印刷も可能
- PPD(PostScript Printer Descreption)
：AdobeのPPD形式
- Webメーすで設定可能
：Webブラウザから設定できるツールが組み込まれている。

CUPSを使った印刷処理の流れ。

- 1,アプリケーションや印刷コマンドから印刷データを受け取る。プリンタの設定オプションはPPDファイルから提供される。
- 2,スプーラが印刷データを受け付け、スケジューリングを行う。
- 3,プリンタが直接受けられないデータを、いったん仲間形式としてPDFまたはPostScriptにフィルタで変換する
- 4,PPDに定義されたフィルタにより、最終の印刷データに変換する
- 5,処理した印刷データをCUPSのバックエンドに送る
- 6,バックエンドは印刷データをローカル接続またはネットワークを経由(IPPやLPRなど)してプリンタに渡す。

`CUPSの起動`

```
//sysvinit
# /etc/init.d/cups start

//systemd
# systemctl start cups.service
``` 

IPPサービスが開いていれば、CUPSは動作している

```
$netstat -at | grep ipp
```

#　10.4.2印刷関連コマンド

`lpr`

ファイルを印刷する時

- -# 部数：印刷部数を指定する
- -P プリンタ名：印刷を行うぷりんたを指定する

印刷内容を標準入力から受け取ることも可能

```
$dmesg | lpr
```

`lpq`

プリンタキューの内容を表示するには、lpqコマンドを使う

- -P　プリンタ名：プリンタを指定する

`lprm`

プリントキューにある印刷要求を削除するには、lprmを使う。

- - ：自分の全印刷ジョブを削除する

