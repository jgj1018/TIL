## 1.サーバ／インフラ構築入門

- システムの冗長化とは、以下のステップを実践することです。①障害を想定する　②障害に備えて予備の機材を準備する　③障害が発生した際に予備の機材に切り替えられる運用体制を整備する
- 予備機は普通使わずにおいて、現用機が故障したら予備機を接続する運用体制を＠「コールドスタンバイ」といいます。現用機と予備機の構成を常に同じ状態にsておくことが定石です。
- ウェブサーバの予備機は常に電源を入れておいて、ネットワークに接続しておくのがよいでしょう。そして、現用機の内容を更新する際には、予備機にも同じ更新がかかるような運用
- 両方のサーバを常に稼働させておき、常に同じ状態に保っておく運用形態を＠「ホットスタンバイ」といいます。
- ここで確認したいことは「ルータがきちんとパケットを転送できているか」なので、インターネット上のホストからウェブサーバに対して監視するのがよいでしょう。要するに、ウェブサーバがインターネットと通信できる状態であることを確認できればいいのです。

- ウェブサーバ、ルータに限らず、ヘルスチェックする際には「何を確認したいのか」を明確にすることが最も重要です。
- IPアドレスを引き継ぐためには、ほかのサーバのARPテーブルを更新してもらわなくてはいけません。


- DNSラウンドロビン：サーバの数だけグローバルアドレスが必要、均等に分散されるとは限らない、PC用のフェブブラウザもDNS問い合わせの結果をキャッシュするため、均等に負荷分散されるとは限らない）
- ロードバランサーは、サービス用のグローバルアドレスを持った仮想的なサーバとして動作する。そして、クライアントから送られてきたリクエストを本物のウェブサーバへ中継することで、あたかも自分がウェブサーバであるかのように振り舞う。
- L4スイッチはトランスポート層までの情報を解析するので、IPアドレスやポート番号によって分散先のサーバを指定することができます。L7スイッチはアプリケーション層までの情報を解析するので、クライアントからリクエストされたURLによって分散先のサーバを指定することができます。IPVSに実装されているのは「L4スイッチ相当の機能」です。
- L7スイッチではロードバランサとクライアントがTCPセッションを張ります。つまり、一つのアクセスに対して、クライアント＜－＞ロードバランサとロードバランサ＜－＞リアルサーバの二つのTCPセッションが張られます。

- 柔軟な設定をしたいならL7スイッチ、パフォーマンスを追求するならL4スイッチ

## 2. ワンランク上のサーバ／インフラの構築

- クライアントとウェブサーバの間にたって要求を代理で処理するのがリバースプロキシの役割です。通常プロキシサーバはLAN->WANの要求を代理で行いますが、リバースプロキシはWAN->LANの要求を代理します。そのため、リバースという名前になってます。
- リバースプロキシを利用すると、クライアントからの要求がウェブサーバへ届く途中の処理に割って入って、さまざまな前後処理を施すことができるようになります。
- HTTPリクエストの内容に応じたシステムの動作の制御(L7スイッチが果たす役割と似ている) 
- 静的コンテンツはメモリ消費量の少ないウェブサーバが応答し、動的コンテンツのみアプリケーションで応答する、という構成が可能になります。

- (Keep-alive)最初の一つのリクエストで確立したサーバとの接続を、そのリクエストが終了した語も切断せずに維持して、続くリクエストでその接続を使いまわすことにより、一本の接続でまとめて多数のリクエストを処理することができます。
- Keep-aliveは一度確立した接続をしばらく維持するという性格上、ウェブサーバ側にある負担を強います。
- クライアントとリバースプロキシの間のみ「Keep-aliveオン」にして、リバースプロキシとバックエンドのAPサーバ間は「Keep-aliveオフ」にします。
- 物理的なホストが1台しかない場合でも、同一ホスト内にリバースプロキシとAPサーバを動かすなどして、「静的コンテンツの配信役とバックエンドのAPサーバ」という役割分担をはっきりさせるほうがサーバリソースの利用効率を上げることができます。
