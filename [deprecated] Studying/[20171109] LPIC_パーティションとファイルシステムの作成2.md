# 5.3 ファイルシステムのマウントとアンマウント

# 5.3.1 マウントの仕組み
# 5.3.2 /etc/fstab　ファイル

```
/dev/sda1 / ext3 defaults 1 1
```

- デバイスファイル名
- マウントポイント
- ファイルシステムの種類
- マウントオプション
：複数のオプションがある場合は　、　で区切る。
- dumpフラグ
:通常、ext2/ext3ファイルシステムは1を、そのほかのファイルシステムは0を指定
- ブード時にfsckがチェックする順序
:0を指定するとチェックされません。

# 5.3.3 マウントとアンマウント

`mount`

- -a /etc/fstabに記述されているファイルシステムをすべてマウントする(noautoオプションがついているものは除く)
- -t ファイルシステムの種類を指定する

```
$ mount -t ext4 /dev/sdb3 /data
```

`umount`

- -a /etc/mtabに記述されているファイルシステムをすべてアンマウントする

/etc/mtabファイルには、マウントされているファイルシステムの情報が格納されている。

# 5.4 ディスククォータの管理

クォータを使うと、ユーザーごと、もしくはグループごとに、ディスク容量の制限ができる

# 5.4.1 クォータの制限

- ソフトリミット：容量制限の警告を発するタイミングがソフトリミット
- ハードリミット：1ユーザーが利用できる最大のディスク容量がハードリミット
- 猶予期間:ソフトリミットを超えた場合、猶予期間に入る。猶予期間が経過すると、ソフトリミットがハードリミットとみなされる。

# 5.4.2 クォータの適用

(1) /etc/fstabファイルで、マウントオプションの指定にusrquotaを追加
```
/dev/sda5 /home ext4 defaults,usrquota 1 2
```
(2) umount->mount

```
umount /home
mount /home
```

(3) quotacheckでクォータデータベースを初期化

```
quotacheck /home
```

(4) quotaon クォータを有効

```
quotaon -auv
```

(5) edquotaでユーザーごとのクォータを設定、repquotaで確認

```
edquota lpic
repquota /home
``` 

# 5.4.3 クォータの管理システム

`quota`

ディスクの使用量とクォータの状況を表示

- -u ユーザークォータの状況を表示（省略可能）
- -g グループクォータの状況を表示
- -v 詳細な情報を表示

```
$quota -uv lpic
```

`quotacheck`

ファイルシステムを調べるディスクの使用量をチェックし、データベースファイルaquota.user, aquota.groupに記録する

- -a /etc/mtabに従って、クォータをチェックする
- -c 既存のデータベースファイルを読み込まない

`quotaon`

設定してあるクォータを有効にする

- -a /etc/fstabに従ってクォータを有効にする

`quotaoff`

<-> quotaon

`edquota`

:ユーザークォータもしくはグループクォータを設定する

`repquota`

指定したファイルシステムのクォータ状況を表示。このコマンドを利用できるのはrootユーザ－のみ

# 5.5ファイルの配置と検索

#5.5.1 FHS(Filesystem Hierarchy Standard)

- /bin : 基本的なコマンド、一般ユーザーも可能
- /sbin : システム管理に必須のコマンド、rootユーザーのみ実行が可能
- /etc : システムやアプリケーションの設定情報、スクリプトファイルなど
- /dev : デバイスファイル
- /lib : /bin /sbinにあるコマンドが必要とするライブラリ
- /mnt : mount point for user
- /opt : パッケージ管理の仕組みを使ってプログラムがインストールされるディレクトリ
- /proc : カーネル内部の情報にアクセスそろための仮想的なファイルシステム
- /boot : 起動に必要な設定やカーネルイメージ
- /var ：ログファイル、メールやプリンタのスプールなど、頻繁に書き換えられるファイルが配置
: /var/lock : アプリケーションが排他制御に使うためのロックファイル 
: /var/log : システムのログファイル(messages),メールシステムのログファイル(maillog) 
: /var/run : システムの状態を示すファイルが配置。特にpidなど
: /var/spool : 印刷まちのデータ(/var/spool/lpd)や予約されてジョブ(/var/spool/at)など処理待ちのデータ 
- /usr : コマンドやユーティリティが配置
: /usr/share x86やx86_64といったシステムアーキテクチャに依存しないファイルが配置
: /usr/src Linuxのカーネルソースなど、ソースコードが配置

# 5.5.2 ファイルの検索

find [directory] [search format]
- -atime : 最終アクセス時刻で検索
- -mtime : 最終更新時刻で検索
- -perm アクセス権；アクセス権で検索
- -size
- -type : f file d directory l symbolic link
- -user ユーザー名：ファイルの所有者で検索
- -print : マッチしたファイルを表示する
- -exec [command] {} \; ：マッチしたファイルに対し、コマンドを実行
- -ok [command] {} \;：マッチしたファイルに対し、コマンドを実行（確認あり）

```
$find /usr/bin -type f -perm -u+s
$find -atime +30 -exec rm {} \;
```

`locate`

あらかじめ作成されたデータベースに基づいて、していされたパターンに一致するファイルの検索

`updatedb`

locateコマンド用データベースの更新

- -e [path]：データベースに取り込まないパスを指定する

```
$updatedb -e /home
```

`which`
:コマンドを探し出して絶対パスを表示

`whereis`
:指定されたコマンドのバイナリファイル、ソースコード、マニュアルファイルが置かれている場所を検索

- -b binary
- -m manual
- -s source

`type`

指定したコマンドが通常の実行ファイルなのか、シェルの組み込みコマンドなのか、エイリアスなのか、といった情報を表示

